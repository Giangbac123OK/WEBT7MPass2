<style>
    .variant-container {
        display: flex;
        gap: 10px;
        align-items: center;
        /* CƒÉn gi·ªØa c√°c ph·∫ßn t·ª≠ */
    }

    .btn-upload {
        color: #f44336;
        border: 1px solid #f44336;
        background-color: #fff;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 6px 12px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.3s;
    }

    .btn-upload:hover {
        background-color: #f44336;
        color: #fff;
    }

    .btn-upload i {
        margin-right: 5px;
        font-size: 18px;
    }

    .hidden-input {
        display: none;
    }

    .position-relative .btn-danger {
        padding: 2px 6px;
        font-size: 12px;
    }

    @media (min-width: 992px) {

        /* M√†n h√¨nh l·ªõn tr·ªü l√™n */
        .col-lg-1-5 {
            flex: 0 0 20%;
            max-width: 20%;
        }
    }

    @media (min-width: 1200px) {

        /* M√†n h√¨nh r·∫•t l·ªõn */
        .col-xl-1-5 {
            flex: 0 0 20%;
            max-width: 20%;
        }
    }
</style>
<div class="container">
    <form ng-submit="saveProduct()" class="p-3 border rounded shadow-sm bg-light " name="frm" novalidate>
        <h4 class="mb-3">Th√™m S·∫£n Ph·∫©m</h4>

        <hr style="border: 2px solid gold;">
        <div class="d-flex">
            <a href="" class="btn btn-primary me-1"><i class="bi bi-tags"></i> Th√™m th∆∞∆°ng hi·ªáu</a>
            <a href="" class="btn btn-primary me-1"><i class="bi bi-box"></i> Th√™m ch·∫•t li·ªáu</a>
            <a href="" class="btn btn-primary me-1"><i class="bi bi-palette"></i> Th√™m m√†u s·∫Øc</a>
            <a href="" class="btn btn-primary"><i class="bi bi-arrows-angle-expand"></i> Th√™m Size</a>
        </div>
        <hr>
        <div class="mb-2 mt-4">
            <label for="tenSanpham">T√™n s·∫£n ph·∫©m:</label>
            <input type="text" class="form-control" id="tenSanpham" name="tenSanpham" ng-minlength="2"
                ng-maxlength="100" ng-model="product.tenSanpham" required placeholder="Nh·∫≠p t√™n s·∫£n ph·∫©m">
            <span
                ng-show="(frm.tenSanpham.$error.required && frm.tenSanpham.$touched) ||(frm.tenSanpham.$error.required && frm.$submitted)"
                class="text-danger">Kh√¥ng ƒë·ªÉ tr·ªëng t√™n s·∫£n ph·∫©m</span>
            <span class="text-danger"
                ng-show="frm.tenSanpham.$error.minlength && (frm.tenSanpham.$touched || frm.$submitted)">
                T√™n s·∫£n ph·∫©m ph·∫£i c√≥ √≠t nh·∫•t 2 k√Ω t·ª±
            </span>
            <!-- Max length -->
            <span class="text-danger"
                ng-show="frm.tenSanpham.$error.maxlength && (frm.tenSanpham.$touched || frm.$submitted)">
                T√™n s·∫£n ph·∫©m kh√¥ng ƒë∆∞·ª£c v∆∞·ª£t qu√° 100 k√Ω t·ª±
            </span>
        </div>
        <div class="mb-2">
            <label>Gi√° b√°n:</label>
            <input type="number" class="form-control" ng-model="product.giaBan" name="giaBan" min="0" max="100000000"
                required placeholder="Nh·∫≠p gi√° ti·ªÅn">

            <span class="text-danger" ng-show="(frm.giaBan.$error.required && frm.giaBan.$touched) || 
                   (frm.giaBan.$error.required && frm.$submitted)">
                Kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng gi√° b√°n
            </span>
            <span class="text-danger" ng-show="frm.giaBan.$error.min && (frm.giaBan.$touched || frm.$submitted)">
                Gi√° b√°n ph·∫£i l·ªõn h∆°n ho·∫∑c b·∫±ng 0
            </span>
            <span class="text-danger" ng-show="frm.giaBan.$error.max && (frm.giaBan.$touched || frm.$submitted)">
                Gi√° b√°n kh√¥ng ƒë∆∞·ª£c v∆∞·ª£t qu√° 100 tri·ªáu
            </span>
            <span class="text-danger" ng-show="frm.giaBan.$error.number && (frm.giaBan.$touched || frm.$submitted)">
                Gi√° b√°n ph·∫£i l√† m·ªôt s·ªë h·ª£p l·ªá
            </span>
        </div>

        <div class="mb-2">
            <label>Th∆∞∆°ng hi·ªáu:</label>
            <select class="form-select" name="idth" ng-model="product.idth" required>
                <option value="" disabled selected>Ch·ªçn th∆∞∆°ng hi·ªáu</option> <!-- M·ª•c m·∫∑c ƒë·ªãnh -->
                <option ng-value="item.id" ng-repeat="item in categories">{{item.tenthuonghieu}}</option>
            </select>
            <span class="text-danger"
                ng-show="(frm.idth.$error.required && frm.idth.$touched) || (frm.idth.$error.required && frm.$submitted)">
                Kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng th∆∞∆°ng hi·ªáu
            </span>
        </div>

        <hr ng-if="product.tenSanpham && product.giaBan && product.idth">

        <button type="button" class="btn btn-primary" data-bs-toggle="modal" ng-click="showAddVariantModal()"
            ng-if="product.tenSanpham && product.giaBan && product.idth">
            <i class="bi bi-plus-circle"></i> <!-- Bi·ªÉu t∆∞·ª£ng th√™m -->
            Th√™m bi·∫øn th·ªÉ
        </button>
        <div class="mt-4" ng-if="product.tenSanpham && product.giaBan && product.idth">
            <h5>Danh s√°ch bi·∫øn th·ªÉ</h5>
            <div class="row g-2 mt-4">
                <div class="col-xl-1-5 col-lg-1-5 col-md-3 col-sm-4 col-6 mb-3" ng-repeat="variant in product.variants">
                    <div class="card shadow-sm border-0 rounded-3">
                        <!-- H√¨nh ·∫£nh s·∫£n ph·∫©m (chi·∫øm to√†n b·ªô ph·∫ßn tr√™n) -->
                        <img ng-if="variant.UrlHinhanh" ng-src="{{variant.UrlHinhanh}}" class="card-img-top"
                            alt="·∫¢nh bi·∫øn th·ªÉ"
                            style="width: 100%; height: 200px; object-fit: cover; border-top-left-radius: 8px; border-top-right-radius: 8px;">

                        <div class="card-body text-center p-2">
                            <div class="d-flex justify-content-between">
                                <h6 class="card-title text-primary fw-bold">üí∞ {{variant.Giathoidiemhientai |
                                    currency:"‚Ç´"}}</h6>
                                <h6 class="card-title text-muted">üì¶ {{variant.Soluong}}</h6>
                            </div>
                            <p class="card-text small">
                                üñåÔ∏è {{ getColorName(variant.IdMau) }} |
                                üëû {{ getSizeName(variant.IdSize) }} |
                                üè≠ {{ getMaterialName(variant.IdChatLieu) }}
                            </p>
                            <span class="badge"
                                ng-class="{'bg-success': variant.Trangthai === 0, 'bg-secondary': variant.Trangthai === 2}">
                                {{ variant.Trangthai === 0 ? 'üü¢ ƒêang b√°n' : '‚ö´ Ng·ª´ng b√°n' }}
                            </span>

                            <div class="d-flex justify-content-between mt-2">
                                <button class="btn btn-warning btn-sm" ng-click="showEditVariantModal(variant, $index)" type="button">  
                                    ‚úèÔ∏è S·ª≠a
                                </button>
                                
                                  
                                <button class="btn btn-danger btn-sm" ng-click="removeVariant($index)">üóëÔ∏è X√≥a</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </div>

        <div class="text-danger" ng-show="product.variants.length === 0 && (frm.$submitted || frm.$touched)">
            B·∫°n c·∫ßn th√™m √≠t nh·∫•t m·ªôt bi·∫øn th·ªÉ cho s·∫£n ph·∫©m.
        </div>
        <hr ng-if="product.variants.length > 0">

        <hr>
        <h5>V·∫≠n chuy·ªÉn</h5>
        <div class="row">
            <div class="col-3">
                <label>Tr·ªçng l∆∞·ª£ng</label>
                <input type="number" name="trongluong" class="form-control" ng-model="product.trongluong"
                    placeholder="Tr·ªçng l∆∞·ª£ng (g)" required>
                <span class="text-danger"
                    ng-show="(frm.trongluong.$error.required && frm.trongluong.$touched) || (frm.trongluong.$error.required && frm.$submitted)">
                    Kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng tr·ªçng l∆∞·ª£ng
                </span>
            </div>
            <div class="col-3">
                <label>Chi·ªÅu d√†i</label>
                <input type="number" name="chieudai" class="form-control" ng-model="product.chieudai"
                    placeholder="Chi·ªÅu d√†i (cm)" min="10" max="150" step="1" ng-pattern="/^\d+$/" required>
                <span class="text-danger"
                    ng-show="(frm.chieudai.$error.required && frm.chieudai.$touched) || (frm.chieudai.$error.required && frm.$submitted)">
                    Kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng chi·ªÅu d√†i
                </span>
                <span class="text-danger"
                    ng-show="frm.chieudai.$error.min && (frm.chieudai.$touched || frm.$submitted)">
                    Chi·ªÅu d√†i ph·∫£i l·ªõn h∆°n ho·∫∑c b·∫±ng 10
                </span>
                <span class="text-danger"
                    ng-show="frm.chieudai.$error.max && (frm.chieudai.$touched || frm.$submitted)">
                    Chi·ªÅu d√†i kh√¥ng ƒë∆∞·ª£c v∆∞·ª£t qu√° 150
                </span>
                <span class="text-danger"
                    ng-show="frm.chieudai.$error.pattern && (frm.chieudai.$touched || frm.$submitted)">
                    Chi·ªÅu d√†i ph·∫£i l√† m·ªôt s·ªë nguy√™n h·ª£p l·ªá
                </span>
            </div>
            <div class="col-3">
                <label>Chi·ªÅu r·ªông</label>
                <input type="number" class="form-control" ng-model="product.chieurong" name="chieurong"
                    placeholder="Chi·ªÅu r·ªông (cm)" min="10" max="150" step="1" ng-pattern="/^\d+$/" required>
                <span class="text-danger"
                    ng-show="(frm.chieurong.$error.required && frm.chieurong.$touched) || (frm.chieurong.$error.required && frm.$submitted)">
                    Kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng chi·ªÅu r·ªông
                </span>
                <span class="text-danger"
                    ng-show="frm.chieurong.$error.min && (frm.chieurong.$touched || frm.$submitted)">
                    Chi·ªÅu r·ªông ph·∫£i l·ªõn h∆°n ho·∫∑c b·∫±ng 10
                </span>
                <span class="text-danger"
                    ng-show="frm.chieurong.$error.max && (frm.chieurong.$touched || frm.$submitted)">
                    Chi·ªÅu r·ªông kh√¥ng ƒë∆∞·ª£c v∆∞·ª£t qu√° 150
                </span>
                <span class="text-danger"
                    ng-show="frm.chieurong.$error.pattern && (frm.chieurong.$touched || frm.$submitted)">
                    Chi·ªÅu r·ªông ph·∫£i l√† m·ªôt s·ªë nguy√™n h·ª£p l·ªá
                </span>
            </div>
            <div class="col-3">
                <label>Chi·ªÅu cao</label>
                <input type="number" class="form-control" ng-model="product.Chieucao" name="Chieucao"
                    placeholder="Chi·ªÅu cao (cm)" min="10" max="150" step="1" ng-pattern="/^\d+$/" required>
                <span class="text-danger"
                    ng-show="(frm.Chieucao.$error.required && frm.Chieucao.$touched) || (frm.Chieucao.$error.required && frm.$submitted)">
                    Kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng chi·ªÅu cao
                </span>
                <span class="text-danger"
                    ng-show="frm.Chieucao.$error.min && (frm.Chieucao.$touched || frm.$submitted)">
                    Chi·ªÅu cao ph·∫£i l·ªõn h∆°n ho·∫∑c b·∫±ng 10
                </span>
                <span class="text-danger"
                    ng-show="frm.Chieucao.$error.max && (frm.Chieucao.$touched || frm.$submitted)">
                    Chi·ªÅu cao kh√¥ng ƒë∆∞·ª£c v∆∞·ª£t qu√° 150
                </span>
                <span class="text-danger"
                    ng-show="frm.Chieucao.$error.pattern && (frm.Chieucao.$touched || frm.$submitted)">
                    Chi·ªÅu cao ph·∫£i l√† m·ªôt s·ªë nguy√™n h·ª£p l·ªá
                </span>
            </div>
            <hr class="mt-4">
            <div class="mb-2">
                <label>M√¥ t·∫£ s·∫£n ph·∫©m:</label>
                <textarea class="form-control" ng-model="product.mota" rows="4" name="mota" ng-minlength="2"
                    ng-maxlength="200" placeholder="Nh·∫≠p m√¥ t·∫£ cho s·∫£n ph·∫©m" required></textarea>
                <small class="text-muted">{{ product.mota.length || 0 }}/200 k√Ω t·ª±</small>
                <span class="text-danger"
                    ng-show="(frm.mota.$error.required && frm.mota.$touched) || (frm.mota.$error.required && frm.$submitted)">
                    Kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng m√¥ t·∫£ s·∫£n ph·∫©m
                </span>
                <span class="text-danger" ng-show="frm.mota.$error.minlength && (frm.mota.$touched || frm.$submitted)">
                    M√¥ t·∫£ s·∫£n ph·∫©m ph·∫£i c√≥ √≠t nh·∫•t 2 k√Ω t·ª±
                </span>
                <span class="text-danger" ng-show="frm.mota.$error.maxlength && (frm.mota.$touched || frm.$submitted)">
                    M√¥ t·∫£ s·∫£n ph·∫©m kh√¥ng ƒë∆∞·ª£c v∆∞·ª£t qu√° 200 k√Ω t·ª±
                </span>
            </div>
            <div class="form-check form-switch mt-3">
                <label>Tr·∫°ng th√°i: </label>
                <input class="form-check-input" type="checkbox" id="productStatus{{$index}}"
                    ng-model="product.trangthai" ng-true-value="0" ng-false-value="2">
                <label class="form-check-label" for="productStatus{{$index}}">
                    {{ product.trangthai === 0 ? 'üü¢ ƒêang b√°n' : '‚ö´ Ng·ª´ng b√°n' }}
                </label>

            </div>

            <div class="d-flex justify-content-center mt-3">
                <button type="submit" class="btn btn-success">Th√™m s·∫£n ph·∫©m</button>
            </div>
    </form>
</div>
<!-- B·∫Øt ƒë·∫ßu modal -->
<div class="modal fade" id="addVariantModal" tabindex="-1" aria-labelledby="addVariantModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addVariantModalLabel">
                    {{ isEditing ? 'Ch·ªânh s·ª≠a Bi·∫øn Th·ªÉ' : 'Th√™m Bi·∫øn Th·ªÉ S·∫£n Ph·∫©m' }}
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
                    ng-click="resetVariantForm()"></button>
            </div>
            <div class="modal-body">
                <form ng-submit="saveVariant()" name="variantForm" novalidate>
                    <div class="row">
                        <!-- C·ªôt tr√°i -->
                        <div class="col-md-6">
                            <!-- M√†u -->
                            <div class="mb-2 mt-3">
                                <label>Ch·ªçn m√†u:</label>
                                <select class="form-select" ng-model="newVariant.IdMau" name="IdMau" required>
                                    <option value="" disabled>Ch·ªçn m√†u</option>
                                    <option ng-value="item.id" ng-repeat="item in colors">{{item.tenmau}}</option>
                                </select>
                                <span class="text-danger"
                                    ng-show="variantForm.IdMau.$touched && variantForm.IdMau.$error.required">
                                    Kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng m√†u s·∫Øc
                                </span>
                            </div>

                            <!-- Size -->
                            <div class="mb-2 mt-3">
                                <label>Ch·ªçn size:</label>
                                <select class="form-select" ng-model="newVariant.IdSize" name="IdSize" required>
                                    <option value="" disabled>Ch·ªçn size</option>
                                    <option ng-value="item.id" ng-repeat="item in sizes">{{item.sosize}}</option>
                                </select>
                                <span class="text-danger"
                                    ng-show="variantForm.IdSize.$touched && variantForm.IdSize.$error.required">
                                    Kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng size
                                </span>
                            </div>

                            <!-- Ch·∫•t li·ªáu -->
                            <div class="mb-2 mt-3">
                                <label>Ch·ªçn ch·∫•t li·ªáu:</label>
                                <select class="form-select" ng-model="newVariant.IdChatLieu" name="IdChatLieu" required>
                                    <option value="" disabled>Ch·ªçn ch·∫•t li·ªáu</option>
                                    <option ng-value="item.id" ng-repeat="item in chatlieus">{{item.tenchatlieu}}</option>
                                </select>
                                <span class="text-danger"
                                    ng-show="variantForm.IdChatLieu.$touched && variantForm.IdChatLieu.$error.required">
                                    Kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng ch·∫•t li·ªáu
                                </span>
                            </div>
                        </div>

                        <!-- C·ªôt ph·∫£i -->
                        <div class="col-md-6">
                            <!-- S·ªë l∆∞·ª£ng -->
                            <div class="mb-2 mt-3">
                                <label>S·ªë l∆∞·ª£ng:</label>
                                <input type="number" class="form-control" ng-model="newVariant.Soluong" name="Soluong"
                                    min="0" max="1000" ng-pattern="/^\d+$/" placeholder="S·ªë l∆∞·ª£ng" required>
                                <span class="text-danger"
                                    ng-show="variantForm.Soluong.$touched && variantForm.Soluong.$error.required">
                                    Kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng s·ªë l∆∞·ª£ng
                                </span>
                                <span class="text-danger"
                                    ng-show="variantForm.Soluong.$touched && variantForm.Soluong.$error.min">
                                    S·ªë l∆∞·ª£ng ph·∫£i l·ªõn h∆°n ho·∫∑c b·∫±ng 0
                                </span>
                                <span class="text-danger"
                                    ng-show="variantForm.Soluong.$touched && variantForm.Soluong.$error.max">
                                    S·ªë l∆∞·ª£ng kh√¥ng ƒë∆∞·ª£c v∆∞·ª£t qu√° 1000
                                </span>
                                <span class="text-danger"
                                    ng-show="variantForm.Soluong.$touched && variantForm.Soluong.$error.pattern">
                                    S·ªë l∆∞·ª£ng ph·∫£i l√† m·ªôt s·ªë nguy√™n h·ª£p l·ªá
                                </span>
                            </div>

                            <!-- Gi√° b√°n -->
                            <div class="mb-2 mt-3">
                                <label>Gi√° b√°n:</label>
                                <button type="button" class="btn btn-primary w-100 mb-2" ng-click="togglePriceField()"
                                    ng-show="!isPriceFieldVisible">
                                    Th√™m Gi√° B√°n
                                </button>

                                <div ng-show="isPriceFieldVisible" class="position-relative mb-1">
                                    <input type="number" class="form-control pe-5"
                                        ng-model="newVariant.Giathoidiemhientai" placeholder="Gi√° b√°n"
                                        name="Giathoidiemhientai" min="0" max="100000000"
                                        ng-required="isPriceFieldVisible">

                                    <button type="button"
                                        class="btn btn-outline-secondary position-absolute top-50 end-0 translate-middle-y me-1 py-1 px-2"
                                        style="z-index: 2;" ng-click="hidePriceField()">
                                        <i class="bi bi-x"></i>
                                    </button>
                                </div>

                                <div class="text-danger" style="font-size: 0.875em;">
                                    <div ng-show="variantForm.Giathoidiemhientai.$touched && variantForm.Giathoidiemhientai.$error.required">
                                        Kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng gi√° b√°n
                                    </div>
                                    <div ng-show="variantForm.Giathoidiemhientai.$touched && variantForm.Giathoidiemhientai.$error.min">
                                        Gi√° b√°n ph·∫£i l·ªõn h∆°n ho·∫∑c b·∫±ng 0
                                    </div>
                                    <div ng-show="variantForm.Giathoidiemhientai.$touched && variantForm.Giathoidiemhientai.$error.max">
                                        Gi√° b√°n kh√¥ng ƒë∆∞·ª£c v∆∞·ª£t qu√° 100 tri·ªáu
                                    </div>
                                </div>
                            </div>

                            <!-- ·∫¢nh -->
                            <div class="mb-2 mt-3 position-relative">
                                <label class="btn-upload" for="imageUpload" ng-show="!newVariant.UrlHinhanh">
                                    <i class="bi bi-camera-fill"></i> Th√™m H√¨nh ·∫¢nh
                                </label>
                                
                                <input type="file" id="imageUpload" class="hidden-input" 
                                    onchange="angular.element(this).scope().handleFileSelect(event, 'newVariant')"
                                    ng-show="!newVariant.UrlHinhanh || allowReplaceImage">
                                

                                <div class="position-relative d-inline-block mt-2" ng-if="newVariant.UrlHinhanh">
                                    <img ng-src="{{newVariant.UrlHinhanh}}" alt="·∫¢nh bi·∫øn th·ªÉ" class="img-thumbnail"
                                        style="width: 150px; height: 150px;">
                                    <button type="button"
                                        class="btn btn-danger btn-sm position-absolute top-0 start-100 translate-middle"
                                        ng-click="newVariant.UrlHinhanh = null">
                                        X
                                    </button>
                                </div>

                                <span class="text-danger" ng-show="variantForm.$submitted && !newVariant.UrlHinhanh">
                                    B·∫°n c·∫ßn th√™m m·ªôt h√¨nh ·∫£nh cho bi·∫øn th·ªÉ s·∫£n ph·∫©m.
                                </span>

                                <!-- Tr·∫°ng th√°i -->
                                <div class="form-check form-switch mt-3">
                                    <label>Tr·∫°ng th√°i: </label>
                                    <input class="form-check-input" type="checkbox"
                                        id="variantStatus{{$index}}"
                                        ng-model="newVariant.Trangthai" ng-true-value="0" ng-false-value="2">
                                    <label class="form-check-label" for="variantStatus{{$index}}">
                                        {{ newVariant.Trangthai === 0 ? 'B·∫≠t' : 'T·∫Øt' }}
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- N√∫t l∆∞u / c·∫≠p nh·∫≠t -->
                    <button type="submit" class="btn btn-success w-100 mt-3">
                        {{ isEditing ? 'C·∫≠p nh·∫≠t' : 'L∆∞u' }}
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
