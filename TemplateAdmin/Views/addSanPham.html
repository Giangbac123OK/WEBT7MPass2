<style>
    .variant-container {
        display: flex;
        gap: 10px;
        align-items: center;
        /* CƒÉn gi·ªØa c√°c ph·∫ßn t·ª≠ */
    }

    .btn-upload {
        color: #f44336;
        border: 1px solid #f44336;
        background-color: #fff;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 6px 12px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.3s;
    }

    .btn-upload:hover {
        background-color: #f44336;
        color: #fff;
    }

    .btn-upload i {
        margin-right: 5px;
        font-size: 18px;
    }

    .hidden-input {
        display: none;
    }

    .position-relative .btn-danger {
        padding: 2px 6px;
        font-size: 12px;
    }
</style>

<form ng-submit="addProduct()" class="p-3 border rounded shadow-sm bg-light">
    <h4 class="mb-3">Th√™m S·∫£n Ph·∫©m</h4>

    <!-- C√°c tr∆∞·ªùng nh·∫≠p li·ªáu kh√°c -->
    <div class="mb-2">
        <label>T√™n s·∫£n ph·∫©m:</label>
        <input type="text" class="form-control" ng-model="product.name" required>
    </div>
    <div class="mb-2">
        <label>Gi√° ti·ªÅn:</label>
        <input type="number" class="form-control" ng-model="product.price" required>
    </div>

    <div class="mb-2">
        <label>Danh m·ª•c:</label>
        <select class="form-select" ng-model="product.category" ng-options="c for c in categories" required></select>
    </div>

    <hr>
   
    <button type="button" class="btn btn-primary" data-bs-toggle="modal" ng-click="showAddVariantModal()" >
        <i class="bi bi-plus-circle"></i>  <!-- Bi·ªÉu t∆∞·ª£ng th√™m -->
        Th√™m bi·∫øn th·ªÉ
    </button>
    <div class="mt-4">
        <h5>Danh s√°ch bi·∫øn th·ªÉ</h5>
        <div class="row g-2">
            <div class="col-md-3 col-sm-6 mb-3" ng-repeat="variant in product.variants">
                <div class="card shadow-sm border-0 rounded-3">
                    <!-- H√¨nh ·∫£nh s·∫£n ph·∫©m -->
                    <div class="d-flex justify-content-center p-3 bg-light rounded-top">
                        <img ng-if="variant.imagePreview" ng-src="{{variant.imagePreview}}" class="card-img-top img-thumbnail"
                             alt="·∫¢nh bi·∫øn th·ªÉ" style="width: 250px; height: 250px; object-fit: cover; border-radius: 8px;">
                    </div>
        
                    <div class="card-body text-center">
                        <div class="d-flex justify-content-between">
                        <h6 class="card-title text-primary fw-bold">üí∞ {{variant.Giathoidiemhientai | currency:"‚Ç´"}}</h6>
                        <h6 class="card-title text-muted">üì¶ {{variant.soluong}} s·∫£n ph·∫©m</h6>
                         </div>
                         <p class="card-text">
                            üñåÔ∏è {{ getColorName(variant.idmau) }} | 
                            üëû {{ getSizeName(variant.idsize) }} | 
                            üè≠ {{ getMaterialName(variant.idchatlieu) }}
                        </p>
                        <span class="badge" ng-class="{'bg-success': variant.status === 0, 'bg-secondary': variant.status === 2}">
                            {{ variant.status === 0 ? 'üü¢ ƒêang b√°n' : '‚ö´ Ng·ª´ng b√°n' }}
                        </span>
                        
                        <div class="d-flex justify-content-between">
                            <button class="btn btn-warning btn-sm">‚úèÔ∏è S·ª≠a</button>
                            <button class="btn btn-danger btn-sm" ng-click="removeVariant($index)">üóëÔ∏è X√≥a</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
    </div>
    <hr>
    <div class="mb-2">
        <label>M√¥ t·∫£ s·∫£n ph·∫©m:</label>
        <textarea class="form-control" ng-model="product.description" rows="4" placeholder="Nh·∫≠p m√¥ t·∫£ cho s·∫£n ph·∫©m"
            required></textarea>
    </div>
    <div class="form-check mt-3">
        <input type="checkbox" class="form-check-input" ng-model="product.trangthai" id="toggleStatus">
        <label class="form-check-label" for="toggleStatus">Tr·∫°ng th√°i</label>
    </div>

    <div class="d-flex justify-content-center mt-3">
        <button type="submit" class="btn btn-success">Th√™m s·∫£n ph·∫©m</button>
    </div>
</form>

<div class="modal fade" id="addVariantModal" tabindex="-1" aria-labelledby="addVariantModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addVariantModalLabel">Th√™m Bi·∫øn Th·ªÉ S·∫£n Ph·∫©m</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form ng-submit="saveVariant()">
                    <div class="row">
                        <!-- C·ªôt b√™n tr√°i (c√°c select) -->
                        <div class="col-md-6">
                            <div class="mb-2 mt-3">
                                <label>Ch·ªçn m√†u:</label>
                                <select class="form-select" ng-model="newVariant.idmau" ng-options="c.id as c.name for c in colors" required>
                                    <option value="">Ch·ªçn m√†u</option>
                                </select>
                            </div>
                            <div class="mb-2 mt-3">
                                <label>Ch·ªçn size:</label>
                                <select class="form-select" ng-model="newVariant.idsize" ng-options="s.id as s.name for s in sizes" required>
                                    <option value="">Ch·ªçn size</option>
                                </select>
                            </div>
                            <div class="mb-2 mt-3">
                                <label>Ch·ªçn ch·∫•t li·ªáu:</label>
                                <select class="form-select" ng-model="newVariant.idchatlieu" ng-options="cl.id as cl.name for cl in chatlieus" required>
                                    <option value="">Ch·ªçn ch·∫•t li·ªáu</option>
                                </select>
                            </div>
                        </div>

                        <!-- C·ªôt b√™n ph·∫£i (c√°c input kh√°c) -->
                        <div class="col-md-6">
                            <div class="mb-2 mt-3">
                                <label>S·ªë l∆∞·ª£ng:</label>
                                <input type="number" class="form-control" ng-model="newVariant.soluong" placeholder="S·ªë l∆∞·ª£ng" required>
                            </div>
                            <div class="mb-2 mt-3">
                                <label>Gi√° b√°n:</label>
                            <button type="button " class="btn btn-primary w-100 mb-2" ng-click="togglePriceField()" ng-show="!isPriceFieldVisible">
                                Th√™m Gi√° B√°n
                            </button>
                            <!-- Tr∆∞·ªùng nh·∫≠p li·ªáu Gi√° B√°n -->
                            <div ng-show="isPriceFieldVisible" class="position-relative ">
                                <input type="number" class="form-control" ng-model="newVariant.Giathoidiemhientai" placeholder="Gi√° b√°n" required>
                                <button type="button" class="btn btn-warning position-absolute top-50 end-0 translate-middle-y" ng-click="hidePriceField()">x√≥a</button>
                            </div>
                            </div>
                            <div class="mb-2 mt-3 position-relative">
                                <!-- ·∫®n n√∫t "Th√™m H√¨nh ·∫¢nh" khi ƒë√£ c√≥ ·∫£nh -->
                                <label class="btn-upload" for="imageUpload" ng-if="!newVariant.imagePreview">
                                    <i class="bi bi-camera-fill"></i> Th√™m H√¨nh ·∫¢nh
                                </label>
                                <input type="file" id="imageUpload" class="hidden-input" multiple
                                    onchange="angular.element(this).scope().handleFileSelect(event, 'newVariant')" ng-if="!newVariant.imagePreview">
                            
                                <!-- Hi·ªÉn th·ªã ·∫£nh v·ªõi n√∫t X ƒë·ªÉ x√≥a -->
                                <div class="position-relative d-inline-block mt-2" ng-if="newVariant.imagePreview">
                                    <img ng-src="{{newVariant.imagePreview}}" alt="·∫¢nh bi·∫øn th·ªÉ" class="img-thumbnail"style="width: 150px; height: 150px;">
                                    <button type="button" class="btn btn-danger btn-sm position-absolute top-0 start-100 translate-middle"
                                        ng-click="newVariant.imagePreview = null">
                                        X
                                    </button>
                                </div>
                            </div>
                            
                            
                            <div class="form-check form-switch mt-3">
                                <label>Tr·∫°ng th√°i: </label>
                                <input class="form-check-input" type="checkbox" id="variantStatus{{$index}}" ng-model="newVariant.status" 
                                       ng-true-value="0" ng-false-value="2">
                                <label class="form-check-label" for="variantStatus{{$index}}">
                                    {{ newVariant.status === 0 ? 'B·∫≠t' : 'T·∫Øt' }}
                                </label>
                            </div>
                            
                        </div>
                        <!--th√™m m√¥ t·∫£-->
                        <div class="mb-2 mt-3 col-md-12">
                            <label>M√¥ t·∫£:</label>
                            <textarea class="form-control" ng-model="newVariant.description" rows="2" placeholder="Nh·∫≠p m√¥ t·∫£ cho bi·∫øn th·ªÉ"></textarea>
                    </div>
                    <button type="submit" class="btn btn-success w-100 mt-3">L∆∞u</button>
                </form>
            </div>
        </div>
    </div>
</div>
