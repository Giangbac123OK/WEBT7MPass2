<style>
    .main-box {
      max-width: 600px;
      margin: auto;
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.05);
      margin-top: 60px;
    }
    #cropModal {
      z-index: 1100 !important;
    }
    .image-container {
      width: 100%;
      max-height: 400px;
      overflow: hidden;
      border: 1px solid #dee2e6;
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 8px;
    }
  
    #imagePreview {
      max-width: 100%;
      max-height: 400px;
      display: block;
    }
  
    .modal-body {
      max-height: 500px;
      overflow-y: auto;
    }
  
    .btn i {
      margin-right: 6px;
    }
  
    .cropped-wrapper {
      position: relative;
      display: inline-block;
    }
  
    .delete-btn {
      position: absolute;
      top: 5px;
      right: 5px;
      background: rgba(255, 0, 0, 0.8);
      color: white;
      border: none;
      border-radius: 50%;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
  
    .delete-btn:hover {
      background: red;
    }
  
    .cropped-img {
      width: 300px;
      height: 300px;
      object-fit: cover;
      border-radius: 8px;
    }
  </style>
  <div class="container">
      <div class="card my-3">
          <div class="d-flex justify-content-between p-2">
              <h5>DANH S√ÅCH NH√ÇN VI√äN</h5>
              <span>{{ time }}</span>
          </div>
      </div>
  
      <div class="card mb-3 py-3">
          <div class="mx-3 mb-3">
              <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#AddModal">
                  <i class="bi bi-plus"></i> Th√™m nh√¢n vi√™n m·ªõi
              </button>
              <button type="button" class="btn btn-warning">
                  <i class="bi bi-arrow-counterclockwise"></i> Ho√†n t√°c
              </button>
              <button type="button" class="btn btn-danger">
                  <i class="bi bi-trash3-fill"></i> Xo√° t·∫•t c·∫£
              </button>
          </div>
          <hr class="mb-3">
          <div class="m-3">
              <table class="table table-bordered">
                  <thead class="text-secondary text-center">
                      <tr>
                          <th><input type="checkbox"></th>
                          <th>ID</th>
                          <th>H·ªç v√† t√™n</th>
                          <th>Avatar</th>
                          <th>Ng√†y sinh</th>
                          <th>Gi·ªõi t√≠nh</th>
                          <th>S·ªë ƒëi·ªán tho·∫°i</th>
                          <th>Email</th>
                          <th>ƒê·ªãa ch·ªâ</th>
                          <th>Ch·ª©c v·ª•</th>
                          <th>H√†nh ƒë·ªông</th>
                      </tr>
                  </thead>
                  <tbody>
                      <tr ng-repeat="x in listNhanVien">
                          <td class="text-center"><input type="checkbox"></td>
                          <td class="text-center">#{{ x.id }}</td>
                          <td>{{ x.hovaten }}</td>
                          <td>
                              <img ng-src="https://localhost:7196/picture/{{ x.avatar ? x.avatar : 'AnhNhanVien.png' }}" width="100px" height="100px" alt="{{ x.hovaten }}">
                          </td>
                          <td class="text-center">{{ x.ngaysinh | date:'dd/MM/yyyy' }}</td>
                          <td class="text-center">{{ x.gioitinh }}</td>
                          <td>{{ x.sdt }}</td>
                          <td>{{ x.email }}</td>
                          <td>{{ x.diachi }}</td>
                          <td class="text-center">
                              <span>{{x.role}}</span>
                          </td>
                          <td class="text-center">
                              <button type="button" class="btn btn-success text-center" data-bs-toggle="modal" data-bs-target="#detailsModal" ng-click="showDetail(x)"><i class="bi bi-person-lines-fill"></i></button>
                              <button type="button" class="btn btn-warning text-center" data-bs-toggle="modal" data-bs-target="#EditNVModal" ng-click="showUpdate(x)"><i class="bi bi-pen-fill"></i></button>
                              <button type="button" class="btn btn-danger text-center" ng-click="btnDelete(x.id)"><i class="bi bi-trash3-fill"></i></button>
                          </td>
                      </tr>
                  </tbody>
              </table>
          </div>
      </div>
  </div>
  <!--Th√™m nh√¢n vi√™n-->
  <div class="modal fade" id="AddModal" tabindex="-1" aria-labelledby="AddModalLabel" aria-hidden="true">
      <div class="modal-dialog">
          <div class="modal-content">
              <div class="modal-header">
                  <h5 class="modal-title" id="AddModalLabel">Th√™m nh√¢n vi√™n</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                  <form name="frmAdd" novalidate>
                      <div class="row mb-3">
                        <div class="col">
                          <label>H·ªç v√† t√™n</label>
                          <input type="text" name="hoten" class="form-control" ng-model="add.hoten"
                                 ng-pattern="/^[a-zA-Z√Ä-·ªπ\s]+$/" required>
                          <span class="text-danger" ng-show="frmAdd.hoten.$touched && frmAdd.hoten.$error.required">
                            Kh√¥ng ƒë∆∞·ª£c b·ªè tr·ªëng
                          </span>
                          <span class="text-danger" ng-show="frmAdd.hoten.$touched && frmAdd.hoten.$error.pattern">
                            Ch·ªâ ƒë∆∞·ª£c nh·∫≠p ch·ªØ c√°i v√† kho·∫£ng tr·∫Øng
                          </span>
                        </div>
                    
                        <div class="col">
                          <label>Ng√†y sinh</label>
                          <input type="date" name="ngaysinh" class="form-control" ng-model="add.ngaysinh" required ng-change="kiemTraTuoi()">
                          <span class="text-danger" ng-show="frmAdd.ngaysinh.$touched && frmAdd.ngaysinh.$error.required">
                            Kh√¥ng ƒë∆∞·ª£c b·ªè tr·ªëng
                          </span>
                          <span class="text-danger" ng-show="frmAdd.ngaysinh.$touched && loiTuoi">
                              Nh√¢n vi√™n ph·∫£i ƒë·ªß 18 tu·ªïi tr·ªü l√™n (t√≠nh theo nƒÉm)
                          </span>
                        </div>
                      </div>
                    
                      <div class="row mb-3">
                        <div class="col">
                          <label>ƒê·ªãa ch·ªâ</label>
                          <input type="text" name="diachi" class="form-control" ng-model="add.diachi" required>
                          <span class="text-danger" ng-show="frmAdd.diachi.$touched && frmAdd.diachi.$error.required">
                            Kh√¥ng ƒë∆∞·ª£c b·ªè tr·ªëng
                          </span>
                        </div>
                    
                        <div class="col">
                          <label>Gi·ªõi t√≠nh</label>
                          <select class="form-select" name="gioitinh" ng-model="add.gioitinh" required aria-label="Default select example">
                              <option disabled selected>Ch·ªçn gi·ªõi t√≠nh</option>
                              <option value="true">Nam</option>
                              <option value="false">N·ªØ</option>
                          </select>
                          <span class="text-danger" ng-show="frmAdd.gioitinh.$touched && frmAdd.gioitinh.$error.required">
                            Kh√¥ng ƒë∆∞·ª£c b·ªè tr·ªëng
                          </span>
                        </div>
                      </div>
  
                      <div class="row mb-3">
                          <div class="col">
                              <label>S·ªë ƒëi·ªán tho·∫°i</label>
                              <input type="text" name="sdt" class="form-control" ng-model="add.sdt"
                                  ng-change="kiemTraSdt()" ng-pattern="/^(0|\+84)[0-9]{9}$/" required>
  
                              <span class="text-danger" ng-show="frmAdd.sdt.$touched && frmAdd.sdt.$error.required">
                                  Kh√¥ng ƒë∆∞·ª£c b·ªè tr·ªëng
                              </span>
                              <span class="text-danger" ng-show="frmAdd.sdt.$touched && frmAdd.sdt.$error.pattern">
                                  S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá. V√≠ d·ª•: 0987654321 ho·∫∑c +84987654321
                              </span>
                              <span class="text-danger" ng-show="loiSdt">
                                  S·ªë ƒëi·ªán tho·∫°i ƒë√£ t·ªìn t·∫°i
                              </span>
                          </div>
                      
                          <div class="col">
                              <label>Email</label>
                              <input type="email" name="email" class="form-control"
                                     ng-model="add.email"
                                     ng-pattern="/^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/"
                                     required ng-change="kiemTraEmail()">
                            
                              <span class="text-danger" ng-show="frmAdd.email.$touched && frmAdd.email.$error.required">
                                Kh√¥ng ƒë∆∞·ª£c b·ªè tr·ªëng
                              </span>
                              <span class="text-danger" ng-show="frmAdd.email.$touched && frmAdd.email.$error.pattern">
                                Email kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng. V√≠ d·ª•: ten@example.com
                              </span>
                              <span class="text-danger" ng-show="frmAdd.email.$touched && loiEmail">
                                  Email ƒë√£ t·ªìn t·∫°i!
                              </span>
                          </div>
                      </div>
  
                      <div class="row mb-3">
                          <div class="col" ng-init="showPassword = false">
                              <label>M·∫≠t kh·∫©u</label>
                              <div class="input-group mb-3">
                                  <input ng-attr-type="{{showPassword ? 'text' : 'password'}}"
                                  name="password"
                                  class="form-control"
                                  ng-model="add.password"
                                  ng-pattern="/^(?=.*[A-Z])(?=.*[\W_])\S+$/"
                                  ng-minlength="8"
                                  ng-maxlength="50"
                                  required>
                                  <button id="basic-addon2" type="button" class="input-group-text btn btn-outline-dark" ng-click="showPassword = !showPassword">
                                      <span ng-show="!showPassword"><i class="bi bi-eye-fill"></i></span> <!-- üëÅ -->
                                      <span ng-show="showPassword"><i class="bi bi-eye-slash-fill"></i></span>  <!-- üëÅÔ∏è‚Äçüó®Ô∏è -->
                                    </button>
                              </div>
                            
                              <!-- C√°c th√¥ng b√°o l·ªói -->
                              <span class="text-danger" ng-show="frmAdd.password.$touched && frmAdd.password.$error.required">
                                Kh√¥ng ƒë∆∞·ª£c b·ªè tr·ªëng
                              </span>
                              <span class="text-danger" ng-show="frmAdd.password.$touched && frmAdd.password.$error.pattern">
                                M·∫≠t kh·∫©u ph·∫£i ch·ª©a √≠t nh·∫•t 1 k√Ω t·ª± in hoa, 1 k√Ω t·ª± ƒë·∫∑c bi·ªát v√† kh√¥ng c√≥ d·∫•u c√°ch
                              </span>
                              <span class="text-danger" ng-show="frmAdd.password.$touched && frmAdd.password.$error.minlength">
                                M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 8 k√Ω t·ª±
                              </span>
                              <span class="text-danger" ng-show="frmAdd.password.$touched && frmAdd.password.$error.maxlength">
                                M·∫≠t kh·∫©u kh√¥ng ƒë∆∞·ª£c v∆∞·ª£t qu√° 50 k√Ω t·ª±
                              </span>
                            </div>
                            
                      
                          <div class="col">
                              <label>Ph√¢n quy·ªÅn</label>
                              <select class="form-select" name="role" ng-model="add.role"required aria-label="Default select example">
                                  <option disabled selected>Ch·ªçn quy·ªÅn h·∫°n</option>
                                  <option value="0">Qu·∫£n l√Ω</option>
                                  <option value="1">Nh√¢n vi√™n</option>
                              </select>
                            
                              <span class="text-danger" ng-show="frmAdd.role.$touched && frmAdd.role.$error.required">
                                Kh√¥ng ƒë∆∞·ª£c b·ªè tr·ªëng
                              </span>
                          </div>
                      </div>
                      <div class="mb-3">
                        <button class="btn btn-outline-primary mb-3" ng-click="openCropModal()" ng-disabled="croppedDataUrl">
                          <i class="fa-solid fa-image"></i> Ch·ªçn v√† C·∫Øt ·∫£nh
                        </button>
                      
                        <div ng-if="croppedDataUrl" class="text-center">
                          <h6 class="mb-3 text-success">·∫¢nh sau khi c·∫Øt:</h6>
                          <div class="cropped-wrapper">
                            <img ng-src="{{croppedDataUrl}}" class="cropped-img img-thumbnail">
                            <button class="delete-btn" ng-click="removeImage()" title="Xo√° ·∫£nh">
                              <i class="fa-solid fa-times"></i>
                            </button>
                          </div>
                        </div>
                      </div>
                  </form>        
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ƒê√≥ng</button>
                  <button type="button" class="btn btn-primary" ng-click="btnAdd()">L∆∞u</button>
              </div>
          </div>
      </div>
  </div>
  <!-- Modal c·∫Øt ·∫£nh -->
  <div class="modal fade" id="cropModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title"><i class="fa-solid fa-crop"></i> C·∫Øt ·∫£nh</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="file" id="imageInput" accept="image/*" class="form-control mb-3" />
          <div class="image-container">
            <img id="imagePreview" />
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-success" ng-click="cropImage()">
            <i class="fa-solid fa-check"></i> C·∫Øt v√† l∆∞u
          </button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content" style="border-radius: 12px; overflow: hidden;">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title" id="staticBackdropLabel">Chi ti·∫øt nh√¢n vi√™n</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ƒê√≥ng"></button>
        </div>
        <div class="modal-body" style="padding: 25px;">
          <div class="row">
            <div class="col-md-4 text-center">
              <img ng-src="https://localhost:7196/picture/{{ detail.avatar ? detail.avatar : 'AnhNhanVien.png' }}"
                   alt="Avatar"
                   style="width: 150px; height: 150px; object-fit: cover; border-radius: 50%; border: 3px solid #007bff;">
              <p style="margin-top: 10px; font-weight: bold;">{{ detail.hovaten }}</p>
              <span class="badge bg-info text-dark">{{ detail.role == 1 ?   'Nh√¢n vi√™n':'Qu·∫£n l√Ω' }}</span>
            </div>
            <div class="col-md-8">
              <div class="mb-2 d-flex">
                <strong class="me-2">Ng√†y sinh:</strong> <span>{{ detail.ngaysinh | date:'dd/MM/yyyy' }}</span>
              </div>
              <div class="mb-2 d-flex">
                <strong class="me-2">ƒê·ªãa ch·ªâ:</strong> <span>{{ detail.diachi }}</span>
              </div>
              <div class="mb-2 d-flex">
                <strong class="me-2">Gi·ªõi t√≠nh:</strong> <span>{{ detail.gioitinh ?  'N·ªØ':'Nam'  }}</span>
              </div>
              <div class="mb-2 d-flex">
                <strong class="me-2">S·ªë ƒëi·ªán tho·∫°i:</strong> <span>{{ detail.sdt }}</span>
              </div>
              <div class="mb-2 d-flex">
                <strong class="me-2">Email:</strong> <span>{{ detail.email }}</span>
              </div>
              <div class="mb-2 d-flex">
                <strong class="me-2">Ng√†y t·∫°o TK:</strong> <span>{{ detail.ngaytaotaikhoan | date:'dd/MM/yyyy' }}</span>
              </div>
              <div class="mb-2 d-flex">
                <strong class="me-2">Tr·∫°ng th√°i:</strong>
                <span class="badge"
                      ng-class="{'bg-success': detail.trangthai == 0, 'bg-secondary': detail.trangthai != 0}">
                  {{ detail.trangthai == 0 ?  'Ng∆∞ng ho·∫°t ƒë·ªông': 'Ho·∫°t ƒë·ªông'}}
                </span>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ƒê√≥ng</button>
        </div>
      </div>
    </div>
  </div>
  <!-- C·∫≠p nh·∫≠t nh√¢n vi√™n -->
  <div class="modal fade" id="UpdateModal" tabindex="-1" aria-labelledby="UpdateModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-warning text-dark">
                <h5 class="modal-title" id="UpdateModalLabel">C·∫≠p nh·∫≠t nh√¢n vi√™n</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
  
            <div class="modal-body">
                <form name="frmUpdate" novalidate>
                    <div class="row mb-3">
                        <div class="col">
                            <label>H·ªç v√† t√™n</label>
                            <input type="text" name="hoten" class="form-control" ng-model="update.hovaten"
                                ng-pattern="/^[a-zA-Z√Ä-·ªπ\s]+$/" required>
                            <span class="text-danger" ng-show="frmUpdate.hoten.$touched && frmUpdate.hoten.$error.required">Kh√¥ng ƒë∆∞·ª£c b·ªè tr·ªëng</span>
                            <span class="text-danger" ng-show="frmUpdate.hoten.$touched && frmUpdate.hoten.$error.pattern">Ch·ªâ ƒë∆∞·ª£c nh·∫≠p ch·ªØ c√°i v√† kho·∫£ng tr·∫Øng</span>
                        </div>
  
                        <div class="col">
                            <label>Ng√†y sinh</label>
                            <input type="date" name="ngaysinh" class="form-control" ng-model="update.ngaysinh" required ng-change="kiemTraTuoiUpdate()">
                            <span class="text-danger" ng-show="frmUpdate.ngaysinh.$touched && frmUpdate.ngaysinh.$error.required">Kh√¥ng ƒë∆∞·ª£c b·ªè tr·ªëng</span>
                            <span class="text-danger" ng-show="frmUpdate.ngaysinh.$touched && loiTuoiUpdate">Ph·∫£i ƒë·ªß 18 tu·ªïi</span>
                        </div>
                    </div>
  
                    <div class="row mb-3">
                        <div class="col">
                            <label>ƒê·ªãa ch·ªâ</label>
                            <input type="text" class="form-control" name="diachi" ng-model="update.diachi" required>
                            <span class="text-danger" ng-show="frmUpdate.diachi.$touched && frmUpdate.diachi.$error.required">Kh√¥ng ƒë∆∞·ª£c b·ªè tr·ªëng</span>
                        </div>
  
                        <div class="col">
                          <label>Gi·ªõi t√≠nh</label>
                          <select class="form-select" name="gioitinh" ng-model="update.gioitinh" required>
                            <option ng-value="true">Nam</option>
                            <option ng-value="false">N·ªØ</option>
                          </select>    
                          <span class="text-danger" ng-show="frmUpdate.gioitinh.$touched && frmUpdate.gioitinh.$error.required">Kh√¥ng ƒë∆∞·ª£c b·ªè tr·ªëng</span>                    
                        </div>
                    </div>
  
                    <div class="row mb-3">
                      <div class="col">
                          <label>S·ªë ƒëi·ªán tho·∫°i</label>
                          <input type="text" name="sdt" class="form-control" ng-model="update.sdt"
                               ng-pattern="/^(0|\+84)[0-9]{9}$/" required>
  
                          <span class="text-danger" ng-show="frmUpdate.sdt.$touched && frmAdd.sdt.$error.required">
                              Kh√¥ng ƒë∆∞·ª£c b·ªè tr·ªëng
                          </span>
                          <span class="text-danger" ng-show="frmUpdate.sdt.$touched && frmAdd.sdt.$error.pattern">
                              S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá. V√≠ d·ª•: 0987654321 ho·∫∑c +84987654321
                          </span>
                      </div>
                  
                      <div class="col">
                          <label>Email</label>
                          <input type="email" name="email" class="form-control"
                                 ng-model="update.email"
                                 ng-pattern="/^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/"
                                 required>
                        
                          <span class="text-danger" ng-show="frmUpdate.email.$touched && frmUpdate.email.$error.required">
                            Kh√¥ng ƒë∆∞·ª£c b·ªè tr·ªëng
                          </span>
                          <span class="text-danger" ng-show="frmUpdate.email.$touched && frmUpdate.email.$error.pattern">
                            Email kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng. V√≠ d·ª•: ten@example.com
                          </span>
                      </div>
                  </div>
  
                    <div class="row mb-3">
                        <div class="col">
                            <label>Ph√¢n quy·ªÅn</label>
                            <select class="form-select" name="role" ng-model="update.role" required>
                              <option ng-value="0">Qu·∫£n l√Ω</option>
                              <option ng-value="1">Nh√¢n vi√™n</option>
                            </select>
                            <span class="text-danger" ng-show="frmUpdate.role.$touched && frmUpdate.role.$error.required">
                              Kh√¥ng ƒë∆∞·ª£c b·ªè tr·ªëng
                            </span>
                        </div>
  
                        <div class="col">
                            <label>Tr·∫°ng th√°i</label>
                            <select class="form-select" name="trangthai" ng-model="update.trangthai" required>
                              <option ng-value="0">Ho·∫°t ƒë·ªông</option>
                              <option ng-value="1">Ng∆∞ng ho·∫°t ƒë·ªông</option>
                          </select>
                          <span class="text-danger" ng-show="frmUpdate.trangthai.$touched && frmUpdate.trangthai.$error.required">
                            Kh√¥ng ƒë∆∞·ª£c b·ªè tr·ªëng
                          </span>
                        </div>
                    </div>
  
                    <div class="mb-3">
                      <button class="btn btn-outline-primary mb-3" ng-click="openCropModal()" ng-disabled="croppedDataUrl">
                        <i class="fa-solid fa-image"></i> Ch·ªçn v√† C·∫Øt ·∫£nh
                      </button>
                    
                      <div ng-if="croppedDataUrl" class="text-center">
                        <h6 class="mb-3 text-success">·∫¢nh sau khi c·∫Øt:</h6>
                        <div class="cropped-wrapper">
                          <img ng-src="{{croppedDataUrl}}" class="cropped-img img-thumbnail">
                          <button class="delete-btn" ng-click="removeImage()" title="Xo√° ·∫£nh">
                            <i class="fa-solid fa-times"></i>
                          </button>
                        </div>
                      </div>
                    </div>
                </form>
            </div>
  
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ƒê√≥ng</button>
                <button type="button" class="btn btn-warning" ng-click="btnUpdate()">L∆∞u thay ƒë·ªïi</button>
            </div>
        </div>
    </div>
  </div>
  