<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tìm kiếm sản phẩm</title>
    
    <!-- Bootstrap 5.3.3 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    
    <!-- AngularJS -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-route/1.8.3/angular-route.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    
    <!-- Custom CSS -->
    <style>
        body {
            background-color: rgb(230, 230, 230);
        }
        
        /* Styles cho search box và suggestions */
        .search-container {
            position: relative;
            width: 100%;
        }
        
        .search-input {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 0 0 5px 5px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 1000;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .suggestion-item {
            padding: 10px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .suggestion-item:hover {
            background-color: #f5f5f5;
        }
        
        .suggestion-item:last-child {
            border-bottom: none;
        }
        
        .highlight {
            color: #dc3545;
            font-weight: 600;
        }
        
        /* Styles cho product cards */
        .product-card {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            margin-bottom: 20px;
            overflow: hidden;
            position: relative;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .discount-badge {
            position: absolute;
            top: 10px;
            left: 0;
            background-color: #dc3545;
            color: white;
            padding: 4px 8px;
            font-size: 12px;
            font-weight: bold;
            z-index: 1;
        }
        
        .product-image-container {
            position: relative;
            padding-top: 100%;
            overflow: hidden;
        }
        
        .product-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }
        
        .product-card:hover .product-image {
            transform: scale(1.05);
        }
        
        .product-details {
            padding: 15px;
        }
        
        .product-brand {
            font-size: 14px;
            color: #888;
            margin-bottom: 5px;
        }
        
        .product-name {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 10px;
            color: #333;
            height: 40px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }
        
        .product-price {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .original-price {
            text-decoration: line-through;
            color: #888;
            font-size: 14px;
            margin-right: 10px;
        }
        
        .sale-price {
            color: #dc3545;
            font-weight: 700;
            font-size: 18px;
        }
        
        .product-rating {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .rating-stars {
            color: #ffc107;
            margin-right: 5px;
        }
        
        .sold-count {
            font-size: 14px;
            color: #666;
        }
        
        .action-buttons {
            display: flex;
            justify-content: space-between;
            padding: 0 15px 15px;
        }
        
        .action-button {
            background: transparent;
            border: none;
            color: #666;
            transition: color 0.2s;
            padding: 5px;
        }
        
        .action-button:hover {
            color: #dc3545;
        }
        
        .wishlist-button {
            border: 1px solid #ddd;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #dc3545;
        }
        
        .wishlist-button:hover {
            background-color: #fff0f0;
        }
        
        /* Styles cho filter section */
        .filter-section {
            background-color: #f0f0f0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .filter-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }
        
        .filter-group {
            margin-bottom: 20px;
        }
        
        .filter-group-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }
        
        .filter-apply-btn {
            background: linear-gradient(to right, #dc3545, #c82333);
            border: none;
            color: white;
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            font-weight: 600;
            transition: opacity 0.3s;
        }
        
        .filter-apply-btn:hover {
            opacity: 0.9;
        }
        
        .form-check-input:checked {
            background-color: #dc3545;
            border-color: #dc3545;
        }
        
        /* Responsive styles */
        @media (max-width: 991.98px) {
            .filter-sidebar {
                position: fixed;
                top: 0;
                left: -300px;
                width: 280px;
                height: 100vh;
                background-color: white;
                z-index: 1000;
                transition: left 0.3s;
                overflow-y: auto;
                padding: 20px;
                box-shadow: 0 0 20px rgba(0,0,0,0.2);
            }
            
            .filter-sidebar.show {
                left: 0;
            }
            
            .mobile-filter-toggle {
                display: flex;
                position: fixed;
                bottom: 70px;
                right: 20px;
                width: 50px;
                height: 50px;
                background-color: #dc3545;
                color: white;
                border-radius: 50%;
                align-items: center;
                justify-content: center;
                box-shadow: 0 2px 10px rgba(0,0,0,0.2);
                z-index: 1000;
            }
            
            .filter-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0,0,0,0.5);
                z-index: 999;
                display: none;
            }
            
            .filter-overlay.show {
                display: block;
            }
        }
        
        /* Loading spinner */
        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #dc3545;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* No results message */
        .no-results {
            text-align: center;
            padding: 40px 0;
        }
        
        .no-results i {
            font-size: 48px;
            color: #ccc;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div ng-app="searchApp" ng-controller="SearchController">
        <div class="container py-4">
            <header class="mb-4">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <h1 class="h4 mb-0">Tìm kiếm sản phẩm</h1>
                    </div>
                    <div class="col-md-6">
                        <div class="search-container">
                            <div class="input-group">
                                <input 
                                    type="text" 
                                    class="form-control search-input" 
                                    placeholder="Tìm kiếm giày..." 
                                    ng-model="searchTerm" 
                                    ng-change="getSuggestions()" 
                                    ng-focus="showSuggestions = true"
                                    autocomplete="off"
                                >
                                <button class="btn btn-outline-danger" type="button" ng-click="search()">
                                    <i class="bi bi-search"></i>
                                </button>
                            </div>
                            
                            <!-- Search Suggestions -->
                            <div class="search-suggestions" ng-show="showSuggestions && suggestions.length > 0">
                                <div class="suggestion-item" ng-repeat="suggestion in suggestions" ng-click="selectSuggestion(suggestion)">
                                    <i class="bi bi-search"></i>
                                    <span ng-bind-html="highlightText(suggestion)"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            
            <!-- Loading Spinner -->
            <div class="loading-spinner" ng-if="loading">
                <div class="spinner"></div>
            </div>
            
            <!-- No Results Message -->
            <div class="no-results" ng-if="!loading && searchPerformed && products.length === 0">
                <i class="bi bi-search"></i>
                <h3>Không tìm thấy sản phẩm phù hợp</h3>
                <p class="text-muted">Vui lòng thử lại với từ khóa khác</p>
            </div>
            
            <!-- Search Results -->
            <div class="row g-4" ng-if="!loading && products.length > 0">
                <!-- Filter Sidebar -->
                <div class="col-lg-3">
                    <div class="filter-sidebar" ng-class="{'show': showMobileFilter}">
                        <div class="d-flex justify-content-between align-items-center mb-3 d-lg-none">
                            <h5 class="mb-0">Bộ lọc</h5>
                            <button class="btn-close" ng-click="toggleMobileFilter()"></button>
                        </div>
                        
                        <div class="filter-section">
                            <h2 class="filter-title">Lọc sản phẩm</h2>
                            
                            <!-- Price Filter -->
                            <div class="filter-group">
                                <h3 class="filter-group-title">Giá</h3>
                                <div class="form-check mb-2" ng-repeat="range in priceRanges">
                                    <input class="form-check-input" type="radio" name="priceRange" id="price{{$index}}" 
                                        ng-model="filters.priceRange" ng-value="range.value">
                                    <label class="form-check-label" for="price{{$index}}">{{range.label}}</label>
                                </div>
                            </div>
                            
                            <!-- Brand Filter -->
                            <div class="filter-group">
                                <h3 class="filter-group-title">Thương hiệu</h3>
                                <div class="form-check mb-2" ng-repeat="brand in brands">
                                    <input class="form-check-input" type="checkbox" name="brand" id="brand{{$index}}" 
                                        ng-model="filters.brands[brand]">
                                    <label class="form-check-label" for="brand{{$index}}">{{brand}}</label>
                                </div>
                            </div>
                            
                            <!-- Size Filter -->
                            <div class="filter-group">
                                <h3 class="filter-group-title">Size</h3>
                                <div class="form-check mb-2" ng-repeat="size in sizes">
                                    <input class="form-check-input" type="checkbox" name="size" id="size{{$index}}" 
                                        ng-model="filters.sizes[size]">
                                    <label class="form-check-label" for="size{{$index}}">{{size}}</label>
                                </div>
                            </div>
                            
                            <button type="button" class="filter-apply-btn" ng-click="applyFilters()">Áp dụng</button>
                        </div>
                    </div>
                </div>
                
                <!-- Product Listing -->
                <div class="col-lg-9">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <p class="mb-0"><span>{{filteredProducts.length}}</span> sản phẩm</p>
                        <div class="d-flex align-items-center">
                            <span>Sắp xếp theo:</span>
                            <select class="form-select ms-2" ng-model="sortOption" ng-change="sortProducts()">
                                <option value="popularity">Phổ biến</option>
                                <option value="newest">Mới nhất</option>
                                <option value="priceAsc">Giá: Thấp đến cao</option>
                                <option value="priceDesc">Giá: Cao đến thấp</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row g-3">
                        <!-- Product Cards -->
                        <div class="col-md-6 col-lg-4" ng-repeat="product in filteredProducts">
                            <div class="product-card">
                                <div class="discount-badge" ng-if="product.discount > 0">{{product.discount}}% GIẢM</div>
                                <div class="product-image-container">
                                    <img ng-src="{{product.image}}" alt="{{product.name}}" class="product-image">
                                </div>
                                <div class="product-details">
                                    <div class="product-brand">{{product.brand}}</div>
                                    <h3 class="product-name">{{product.name}}</h3>
                                    <div class="product-price">
                                        <span class="original-price" ng-if="product.originalPrice">{{product.originalPrice | currency:"":0}}₫</span>
                                        <span class="sale-price">{{product.salePrice | currency:"":0}}₫</span>
                                    </div>
                                    <div class="product-rating">
                                        <div class="rating-stars">
                                            <i class="bi" 
                                               ng-repeat="star in [1,2,3,4,5]" 
                                               ng-class="{'bi-star-fill': star <= product.rating, 'bi-star-half': star - 0.5 <= product.rating && star > product.rating, 'bi-star': star > product.rating && star - 0.5 > product.rating}">
                                            </i>
                                        </div>
                                        <span class="sold-count">{{product.soldCount}} đã bán</span>
                                    </div>
                                </div>
                                <div class="action-buttons">
                                    <div>
                                        <button class="action-button" ng-click="addToCart(product)">
                                            <i class="bi bi-cart"></i>
                                        </button>
                                        <button class="action-button" ng-click="viewProductDetail(product)">
                                            <i class="bi bi-search"></i>
                                        </button>
                                    </div>
                                    <button class="wishlist-button" ng-click="toggleWishlist(product)">
                                        <i class="bi" ng-class="{'bi-heart': !product.inWishlist, 'bi-heart-fill': product.inWishlist}"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pagination -->
                    <nav aria-label="Page navigation" class="mt-4" ng-if="totalPages > 1">
                        <ul class="pagination justify-content-center">
                            <li class="page-item" ng-class="{'disabled': currentPage === 1}">
                                <a class="page-link" href="#" ng-click="changePage(currentPage - 1)" tabindex="-1">
                                    <i class="bi bi-chevron-left"></i>
                                </a>
                            </li>
                            <li class="page-item" ng-repeat="page in getPages()" ng-class="{'active': currentPage === page}">
                                <a class="page-link" href="#" ng-click="changePage(page)">{{page}}</a>
                            </li>
                            <li class="page-item" ng-class="{'disabled': currentPage === totalPages}">
                                <a class="page-link" href="#" ng-click="changePage(currentPage + 1)">
                                    <i class="bi bi-chevron-right"></i>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
        
        <!-- Mobile Filter Button & Overlay -->
        <button class="mobile-filter-toggle d-lg-none" ng-click="toggleMobileFilter()" ng-if="!loading && products.length > 0">
            <i class="bi bi-funnel-fill"></i>
        </button>
        <div class="filter-overlay" ng-class="{'show': showMobileFilter}" ng-click="toggleMobileFilter()"></div>
    </div>
    
    <!-- AngularJS App -->
    <script>
        var app = angular.module('searchApp', []);
        
        app.controller('SearchController', function($scope, $http, $timeout, $sce) {
            // Khởi tạo biến
            $scope.searchTerm = '';
            $scope.suggestions = [];
            $scope.showSuggestions = false;
            $scope.products = [];
            $scope.filteredProducts = [];
            $scope.loading = false;
            $scope.searchPerformed = false;
            $scope.showMobileFilter = false;
            
            // Phân trang
            $scope.currentPage = 1;
            $scope.itemsPerPage = 9;
            $scope.totalPages = 1;
            
            // Sắp xếp
            $scope.sortOption = 'popularity';
            
            // Bộ lọc
            $scope.filters = {
                priceRange: '0-0',
                brands: {},
                sizes: {}
            };
            
            // Dữ liệu cho bộ lọc
            $scope.priceRanges = [
                { value: '0-1000000', label: 'DƯỚI 1,000,000₫' },
                { value: '1000000-2000000', label: '1,000,000₫->2,000,000₫' },
                { value: '2000000-3000000', label: '2,000,000₫->3,000,000₫' },
                { value: '3000000-4000000', label: '3,000,000₫->4,000,000₫' },
                { value: '4000000-0', label: 'TRÊN 4,000,000₫' }
            ];
            
            $scope.brands = ['NIKE', 'ADIDAS', 'PUMA', 'CONVERSE', 'VANS', 'NEW BALANCE'];
            $scope.sizes = ['36', '37', '38', '39', '40', '41', '42', '43', '44', '45'];
            
            // Biến debounce cho tìm kiếm gợi ý
            var debounceTimer;
            
            // Hàm lấy gợi ý tìm kiếm
            $scope.getSuggestions = function() {
                if ($scope.searchTerm.length < 2) {
                    $scope.suggestions = [];
                    $scope.showSuggestions = false;
                    return;
                }
                
                // Xóa timer cũ
                if (debounceTimer) {
                    $timeout.cancel(debounceTimer);
                }
                
                // Tạo timer mới
                debounceTimer = $timeout(function() {
                    // Trong môi trường thực tế, gọi API để lấy gợi ý
                    // $http.get('https://your-backend-url/api/search/suggestions?term=' + encodeURIComponent($scope.searchTerm))
                    //     .then(function(response) {
                    //         $scope.suggestions = response.data.suggestions;
                    //         $scope.showSuggestions = $scope.suggestions.length > 0;
                    //     })
                    //     .catch(function(error) {
                    //         console.error('Lỗi khi lấy gợi ý tìm kiếm:', error);
                    //     });
                    
                    // Dữ liệu mẫu cho gợi ý
                    var allSuggestions = [
                        'giày nike air force 1',
                        'giày adidas superstar',
                        'giày thể thao nam',
                        'giày thể thao nữ',
                        'giày chạy bộ',
                        'giày đá bóng',
                        'giày sneaker',
                        'giày converse',
                        'giày vans old skool',
                        'giày puma',
                        'giày new balance',
                        'giày jordan',
                        'giày balenciaga',
                        'giày sandal',
                        'giày cao gót',
                        'giày lười nam',
                        'giày tây',
                        'giày boot',
                        'giày đi mưa',
                        'giày đi biển'
                    ];
                    
                    // Lọc gợi ý phù hợp với từ khóa
                    $scope.suggestions = allSuggestions
                        .filter(function(sugg) {
                            return sugg.toLowerCase().includes($scope.searchTerm.toLowerCase());
                        })
                        .slice(0, 8); // Giới hạn 8 gợi ý
                    
                    $scope.showSuggestions = $scope.suggestions.length > 0;
                }, 300);
            };
            
            // Hàm highlight từ khóa trong gợi ý
            $scope.highlightText = function(text) {
                if (!$scope.searchTerm) return text;
                
                var searchTermEscaped = $scope.searchTerm.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                var regex = new RegExp('(' + searchTermEscaped + ')', 'gi');
                
                return $sce.trustAsHtml(text.replace(regex, '<span class="highlight">$1</span>'));
            };
            
            // Hàm chọn gợi ý
            $scope.selectSuggestion = function(suggestion) {
                $scope.searchTerm = suggestion;
                $scope.showSuggestions = false;
                $scope.search();
            };
            
            // Hàm tìm kiếm
            $scope.search = function() {
                if ($scope.searchTerm.length < 2) return;
                
                $scope.loading = true;
                $scope.showSuggestions = false;
                $scope.searchPerformed = true;
                
                // Trong môi trường thực tế, gọi API để lấy kết quả tìm kiếm
                // $http.get('https://your-backend-url/api/search/products?term=' + encodeURIComponent($scope.searchTerm))
                //     .then(function(response) {
                //         $scope.products = response.data.products;
                //         $scope.applyFilters();
                //         $scope.updatePagination();
                //     })
                //     .catch(function(error) {
                //         console.error('Lỗi khi tìm kiếm sản phẩm:', error);
                //         $scope.products = [];
                //         $scope.filteredProducts = [];
                //     })
                //     .finally(function() {
                //         $scope.loading = false;
                //     });
                
                // Dữ liệu mẫu cho kết quả tìm kiếm
                $timeout(function() {
                    // Giả lập kết quả tìm kiếm
                    var mockProducts = [
                        {
                            id: '1',
                            name: 'Giày Nike Air Force 1 Low White',
                            brand: 'NIKE',
                            originalPrice: 2900000,
                            salePrice: 2500000,
                            discount: 14,
                            image: 'https://via.placeholder.com/300x300.png?text=Nike+Air+Force+1',
                            rating: 4.8,
                            soldCount: 1243,
                            sizes: ['38', '39', '40', '41', '42'],
                            inWishlist: false
                        },
                        {
                            id: '2',
                            name: 'Giày Adidas Superstar Classic',
                            brand: 'ADIDAS',
                            originalPrice: 2200000,
                            salePrice: 1800000,
                            discount: 18,
                            image: 'https://via.placeholder.com/300x300.png?text=Adidas+Superstar',
                            rating: 4.7,
                            soldCount: 987,
                            sizes: ['37', '38', '39', '40', '41', '42', '43'],
                            inWishlist: false
                        },
                        {
                            id: '3',
                            name: 'Giày Converse Chuck Taylor All Star Classic',
                            brand: 'CONVERSE',
                            originalPrice: 1500000,
                            salePrice: 1350000,
                            discount: 10,
                            image: 'https://via.placeholder.com/300x300.png?text=Converse+Chuck+Taylor',
                            rating: 4.6,
                            soldCount: 756,
                            sizes: ['36', '37', '38', '39', '40', '41', '42', '43'],
                            inWishlist: false
                        },
                        {
                            id: '4',
                            name: 'Giày Vans Old Skool Classic Black',
                            brand: 'VANS',
                            originalPrice: 1800000,
                            salePrice: 1600000,
                            discount: 11,
                            image: 'https://via.placeholder.com/300x300.png?text=Vans+Old+Skool',
                            rating: 4.5,
                            soldCount: 654,
                            sizes: ['36', '37', '38', '39', '40', '41', '42'],
                            inWishlist: false
                        },
                        {
                            id: '5',
                            name: 'Giày Puma Suede Classic',
                            brand: 'PUMA',
                            originalPrice: 1900000,
                            salePrice: 1700000,
                            discount: 11,
                            image: 'https://via.placeholder.com/300x300.png?text=Puma+Suede',
                            rating: 4.4,
                            soldCount: 543,
                            sizes: ['38', '39', '40', '41', '42', '43'],
                            inWishlist: false
                        },
                        {
                            id: '6',
                            name: 'Giày New Balance 574 Classic',
                            brand: 'NEW BALANCE',
                            originalPrice: 2100000,
                            salePrice: 1850000,
                            discount: 12,
                            image: 'https://via.placeholder.com/300x300.png?text=New+Balance+574',
                            rating: 4.6,
                            soldCount: 432,
                            sizes: ['39', '40', '41', '42', '43', '44'],
                            inWishlist: false
                        },
                        {
                            id: '7',
                            name: 'Giày Nike Air Jordan 1 Mid',
                            brand: 'NIKE',
                            originalPrice: 3200000,
                            salePrice: 2800000,
                            discount: 13,
                            image: 'https://via.placeholder.com/300x300.png?text=Nike+Jordan+1',
                            rating: 4.9,
                            soldCount: 876,
                            sizes: ['38', '39', '40', '41', '42', '43', '44'],
                            inWishlist: false
                        },
                        {
                            id: '8',
                            name: 'Giày Adidas Ultra Boost',
                            brand: 'ADIDAS',
                            originalPrice: 4200000,
                            salePrice: 3800000,
                            discount: 10,
                            image: 'https://via.placeholder.com/300x300.png?text=Adidas+Ultra+Boost',
                            rating: 4.8,
                            soldCount: 765,
                            sizes: ['39', '40', '41', '42', '43', '44'],
                            inWishlist: false
                        },
                        {
                            id: '9',
                            name: 'Giày Converse Chuck 70s High Top',
                            brand: 'CONVERSE',
                            originalPrice: 1900000,
                            salePrice: 1700000,
                            discount: 11,
                            image: 'https://via.placeholder.com/300x300.png?text=Converse+Chuck+70s',
                            rating: 4.7,
                            soldCount: 543,
                            sizes: ['36', '37', '38', '39', '40', '41', '42'],
                            inWishlist: false
                        },
                        {
                            id: '10',
                            name: 'Giày Vans Authentic Classic',
                            brand: 'VANS',
                            originalPrice: 1500000,
                            salePrice: 1350000,
                            discount: 10,
                            image: 'https://via.placeholder.com/300x300.png?text=Vans+Authentic',
                            rating: 4.5,
                            soldCount: 432,
                            sizes: ['36', '37', '38', '39', '40', '41', '42'],
                            inWishlist: false
                        },
                        {
                            id: '11',
                            name: 'Giày Nike Air Max 90',
                            brand: 'NIKE',
                            originalPrice: 3100000,
                            salePrice: 2700000,
                            discount: 13,
                            image: 'https://via.placeholder.com/300x300.png?text=Nike+Air+Max+90',
                            rating: 4.7,
                            soldCount: 654,
                            sizes: ['38', '39', '40', '41', '42', '43'],
                            inWishlist: false
                        },
                        {
                            id: '12',
                            name: 'Giày Adidas Stan Smith',
                            brand: 'ADIDAS',
                            originalPrice: 2000000,
                            salePrice: 1800000,
                            discount: 10,
                            image: 'https://via.placeholder.com/300x300.png?text=Adidas+Stan+Smith',
                            rating: 4.6,
                            soldCount: 543,
                            sizes: ['37', '38', '39', '40', '41', '42', '43'],
                            inWishlist: false
                        }
                    ];
                    
                    // Lọc sản phẩm theo từ khóa tìm kiếm
                    $scope.products = mockProducts.filter(function(product) {
                        return product.name.toLowerCase().includes($scope.searchTerm.toLowerCase()) || 
                               product.brand.toLowerCase().includes($scope.searchTerm.toLowerCase());
                    });
                    
                    $scope.applyFilters();
                    $scope.updatePagination();
                    $scope.loading = false;
                }, 800); // Giả lập độ trễ mạng
            };
            
            // Hàm áp dụng bộ lọc
            $scope.applyFilters = function() {
                // Lọc sản phẩm theo các tiêu chí
                $scope.filteredProducts = $scope.products.filter(function(product) {
                    // Lọc theo giá
                    if ($scope.filters.priceRange !== '0-0') {
                        var [minPrice, maxPrice] = $scope.filters.priceRange.split('-').map(Number);
                        if (minPrice > 0 && product.salePrice < minPrice) return false;
                        if (maxPrice > 0 && product.salePrice > maxPrice) return false;
                    }
                    
                    // Lọc theo thương hiệu
                    var selectedBrands = Object.keys($scope.filters.brands).filter(function(brand) {
                        return $scope.filters.brands[brand];
                    });
                    
                    if (selectedBrands.length > 0 && !selectedBrands.includes(product.brand)) {
                        return false;
                    }
                    
                    // Lọc theo size
                    var selectedSizes = Object.keys($scope.filters.sizes).filter(function(size) {
                        return $scope.filters.sizes[size];
                    });
                    
                    if (selectedSizes.length > 0) {
                        var hasSize = selectedSizes.some(function(size) {
                            return product.sizes.includes(size);
                        });
                        
                        if (!hasSize) return false;
                    }
                    
                    return true;
                });
                
                // Sắp xếp sản phẩm
                $scope.sortProducts();
                
                // Cập nhật phân trang
                $scope.currentPage = 1;
                $scope.updatePagination();
                
                // Đóng filter trên mobile
                if (window.innerWidth < 992) {
                    $scope.showMobileFilter = false;
                }
            };
            
            // Hàm sắp xếp sản phẩm
            $scope.sortProducts = function() {
                $scope.filteredProducts.sort(function(a, b) {
                    switch ($scope.sortOption) {
                        case 'priceAsc':
                            return a.salePrice - b.salePrice;
                        case 'priceDesc':
                            return b.salePrice - a.salePrice;
                        case 'newest':
                            // Trong thực tế, sẽ sắp xếp theo ngày
                            return b.id - a.id;
                        case 'popularity':
                        default:
                            return b.soldCount - a.soldCount;
                    }
                });
                
                $scope.updatePagination();
            };
            
            // Hàm cập nhật phân trang
            $scope.updatePagination = function() {
                $scope.totalPages = Math.ceil($scope.filteredProducts.length / $scope.itemsPerPage);
                
                // Giới hạn sản phẩm hiển thị theo trang hiện tại
                var startIndex = ($scope.currentPage - 1) * $scope.itemsPerPage;
                var endIndex = startIndex + $scope.itemsPerPage;
                
                $scope.displayedProducts = $scope.filteredProducts.slice(startIndex, endIndex);
            };
            
            // Hàm chuyển trang
            $scope.changePage = function(page) {
                if (page < 1 || page > $scope.totalPages) return;
                
                $scope.currentPage = page;
                $scope.updatePagination();
                
                // Cuộn lên đầu danh sách sản phẩm
                window.scrollTo({
                    top: document.querySelector('.product-listing').offsetTop - 100,
                    behavior: 'smooth'
                });
            };
            
            // Hàm tạo mảng số trang
            $scope.getPages = function() {
                var pages = [];
                var startPage = Math.max(1, $scope.currentPage - 2);
                var endPage = Math.min($scope.totalPages, startPage + 4);
                
                for (var i = startPage; i <= endPage; i++) {
                    pages.push(i);
                }
                
                return pages;
            };
            
            // Hàm toggle filter trên mobile
            $scope.toggleMobileFilter = function() {
                $scope.showMobileFilter = !$scope.showMobileFilter;
                
                // Khóa/mở khóa scroll của body
                document.body.style.overflow = $scope.showMobileFilter ? 'hidden' : '';
            };
            
            // Hàm thêm vào giỏ hàng
            $scope.addToCart = function(product) {
                // Trong thực tế, gọi API để thêm sản phẩm vào giỏ hàng
                alert('Đã thêm ' + product.name + ' vào giỏ hàng!');
            };
            
            // Hàm xem chi tiết sản phẩm
            $scope.viewProductDetail = function(product) {
                // Trong thực tế, chuyển hướng đến trang chi tiết sản phẩm
                alert('Xem chi tiết sản phẩm: ' + product.name);
            };
            
            // Hàm toggle wishlist
            $scope.toggleWishlist = function(product) {
                product.inWishlist = !product.inWishlist;
                
                // Trong thực tế, gọi API để thêm/xóa sản phẩm khỏi wishlist
                if (product.inWishlist) {
                    alert('Đã thêm ' + product.name + ' vào danh sách yêu thích!');
                } else {
                    alert('Đã xóa ' + product.name + ' khỏi danh sách yêu thích!');
                }
            };
            
            // Xử lý sự kiện click ra ngoài để ẩn gợi ý
            document.addEventListener('click', function(e) {
                var searchContainer = document.querySelector('.search-container');
                if (searchContainer && !searchContainer.contains(e.target)) {
                    $scope.$apply(function() {
                        $scope.showSuggestions = false;
                    });
                }
            });
        });
        
        // Filter để định dạng tiền tệ
        app.filter('currency', function() {
            return function(input, symbol, fractionSize) {
                if (isNaN(input)) return input;
                
                var formattedValue = input.toLocaleString('vi-VN');
                return formattedValue;
            };
        });
    </script>
</body>
</html>

