<!-- Views/timkiem.html -->
<div class="container mt-5">
  <h2 class="text-center mb-4">Kết quả tìm kiếm: "{{searchKey}}"</h2>

  <!-- Error Message Section -->
  <div ng-if="errorMessage" class="alert alert-danger text-center">
    {{errorMessage}}
  </div>

  <div class="row">
    <!-- Filter Section -->
    <div class="col-md-3">
      <div class="card shadow-sm p-3 mb-4">
        <h5 class="mb-3"><i class="bi bi-funnel"></i> Bộ lọc tìm kiếm</h5>

        <!-- Price Filter -->
        <div class="mb-4">
          <h6 class="font-weight-bold">Theo giá sản phẩm</h6>
          
          <!-- Radio buttons for price ranges -->
          <div class="form-check mb-2" ng-repeat="range in priceRanges">
            <input class="form-check-input" type="radio" name="priceRange" 
                   id="price{{$index}}" ng-model="filters.priceRange" ng-value="range.value">
            <label class="form-check-label" for="price{{$index}}">
              {{range.label}}
            </label>
          </div>
          
          <!-- Custom price range -->
          <div class="mt-3">
            <label class="form-label">Từ</label>
            <input type="number" class="form-control mb-2" ng-model="filters.minPrice" min="0" placeholder="Nhập giá thấp nhất">
            <label class="form-label">Đến</label>
            <input type="number" class="form-control mb-3" ng-model="filters.maxPrice" min="0" placeholder="Nhập giá cao nhất">
          </div>
        </div>

        <!-- Brand Filter -->
        <div class="mb-4">
          <h6 class="font-weight-bold">Theo thương hiệu</h6>
          <div class="form-check mb-2" ng-repeat="brand in dataThuonghieu" ng-if="brand.tinhtrang==0">
            <input class="form-check-input" type="checkbox" id="brand{{brand.id}}" 
                   ng-model="filters.brands[brand.id]">
            <label class="form-check-label" for="brand{{brand.id}}">
              {{brand.tenthuonghieu}}
            </label>
          </div>
        </div>

        <!-- Size Filter -->
        <div class="mb-4">
          <h6 class="font-weight-bold">Theo kích thước</h6>
          <div class="form-check mb-2" ng-repeat="size in availableSizes">
            <input class="form-check-input" type="checkbox" id="size{{$index}}" 
                   ng-model="filters.sizes[size]">
            <label class="form-check-label" for="size{{$index}}">
              {{size}}
            </label>
          </div>
        </div>

        <!-- Apply and Reset Buttons -->
        <button class="btn btn-danger w-100 mb-2" ng-click="applyAllFilters()">Áp dụng</button>
        <button class="btn btn-secondary w-100" ng-click="resetFilters()">Xóa tất cả</button>
      </div>
    </div>
    
    <!-- Product List Section -->
    <div class="col-md-9">
      <div class="row product-grid">
        <!-- Product Cards -->
        <div ng-repeat="item in displayResults" class="col-lg-4 col-md-6 col-sm-6 mb-4">
          <a class="card shadow-sm product-card text-decoration-none h-100" 
             href="#!sanphamchitiet/{{item.id}}" 
             ng-class="{'disabled-card': item.soluong === 0}">
            
            <!-- Discount Badge -->
            <div class="position-relative">
              <div class="discount-badge" ng-if="item.giaTriGiam > 0 && item.giaTriGiam <= 100">
                -{{item.giaTriGiam}}%
              </div>
              <div class="discount-badge" ng-if="item.giaTriGiam > 0 && item.giaTriGiam > 100">
                -{{item.giaTriGiam| number : 0}}VNĐ
              </div>
              <img ng-src="{{item.urlHinhanh}}" alt="{{item.tensp}}" class="card-img-top img-fluid">
            </div>
            
            <div class="card-body d-flex flex-column">
              <div ng-repeat="brand in dataThuonghieu" ng-if="brand.id==item.idth">
                <h6 class="fw-bold">[{{brand.tenthuonghieu}}] - {{item.tensp}}</h6>
              </div>
              
              <!-- Price Display -->
              <div class="d-flex justify-content-between mt-auto">
                <div class="text-decoration-line-through text-muted" 
                     ng-if="item.giaban > item.giasale && item.giasale !== item.giaban">
                  {{item.giaban| number : 0}}VNĐ
                </div>
                <div class="text-danger fw-bold ms-auto" 
                     ng-if="item.giasale === item.giaban">
                  {{item.giaban| number : 0}}VNĐ
                </div>
                <div class="text-danger fw-bold" 
                     ng-if="item.giaban > item.giasale && item.giasale !== item.giaban">
                  {{item.giasale| number : 0}}VNĐ
                </div>
              </div>
              
              <!-- Rating and Sales -->
              <div class="d-flex justify-content-between align-items-center mt-2">
                <div class="rating-stars">
                  <span ng-repeat="star in generateStars(item.trungBinhDanhGia) track by $index">
                    <i class="bi" ng-class="{
                      'bi-star-fill text-warning': star === 'full',
                      'bi-star-half text-warning': star === 'half',
                      'bi-star text-muted': star === 'empty'
                    }"></i>
                  </span>
                </div>
                <small class="text-muted">Đã bán: {{item.soLuongBan || 0}}</small>
              </div>
            </div>
          </a>
        </div>
      </div>
      
      <!-- No Results Message -->
      <div ng-if="displayResults.length === 0 && !errorMessage" class="text-center text-danger mt-5 p-5 border rounded">
        <i class="bi bi-search" style="font-size: 3rem;"></i>
        <p class="mt-3">Không tìm thấy kết quả nào phù hợp với "{{searchKey}}"</p>
        <p>Vui lòng thử lại với từ khóa khác hoặc điều chỉnh bộ lọc.</p>
      </div>
    </div>
  </div>
</div>

<style>
  .product-card {
    transition: all 0.3s ease;
    height: 100%;
  }

  .product-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important;
  }

  .disabled-card {
    opacity: 0.5;
    pointer-events: none;
  }

  .discount-badge {
    position: absolute;
    top: 10px;
    right: 10px;
    background: #ffcc00;
    color: #222;
    padding: 6px 12px;
    font-size: 14px;
    font-weight: bold;
    border-radius: 5px;
    z-index: 10;
  }

  .rating-stars {
    display: flex;
    align-items: center;
  }
</style>